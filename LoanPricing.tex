\documentclass{article}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{cite}
\usepackage{float}
\theoremstyle{definition}
\newtheorem{theorem}{Theorem}
\newtheorem{goal}{Goal}
\newenvironment{sketchproof}{%
  \renewcommand{\proofname}{Sketch of Proof}\proof}{\endproof}
  
\setlength{\parindent}{0pt}

\begin{document}

\section{Introduction}



\section{Mathematical preliminaries and definitions of loans}
Before diving in on pricing theory, it is useful to consider the definition and characterization of loans.  Loans involve the providing of money from party A (the lender) to party B (the borrower).  In return, party B pays party A over a (often predefined) set of times.  The terms of the loan typically require the sum of party B's payments to be greater than the original amount of money transferred to party B.  The excess of money that B pays A is called ``interest''.  The annualized percentage of interest relative to the original transfer is called the ``interest rate''.  

\subsection{Mathematical formulation}
Put mathematically, a loan involves an exchange of money \(P_t\) from the lender to the borrower at time \(t\).  The borrower then cumulatively pays the lender \(\int_t ^ \infty c_s ds\) for the original amount \(P_t\).  
\\
\\
Typically, there is some point \(T\) which satisfies \(c_s=0\, \forall\, T<s<\infty\); that is \(T= \sup\{c_s>0 | s>=t\} \).  At this point, the loan is considered to be closed and neither party is beholding to the other.  Having a terminal or maturity date \(T\) allows us to mathematically define the ``continuously compounded'' interest rate:

\begin{equation} \label{rateCC} r_{t, T}=\frac{\mathrm{log}\left(\frac{\int_t ^ T c_s ds}{P_t}\right)}{ T-t} \end{equation}

Another commonly quoted interest rate is the ``simple interest rate'':
\begin{equation} \label{rateS} r_{t, T}=\frac{\frac{\int_t ^ T c_s ds}{P_t}-1}{ T-t} \end{equation}

Depending on the problem, it is sometimes easier to use \ref{rateCC} or \ref{rateS}.  Unless stated otherwise, we will mean \ref{rateCC} when we use the notation \(r_{t, T}\).


\subsection{Risks}
Loans introduce risk to the lender.  There are two primary risks: interest rate risk and credit risk.  Interest rate risk is the risk that alternative investments may be more attractive at some point \(\tau>t\).  However, there is often no good way to ``undo'' the loan and take advantage of alternative investments.  Credit risk is the risk that the borrower does not pay the agreed upon cash flow; that is, the borrower defaults.  
\\
\\
There are some ways to remediate or immunize these risk.  Interest rate risk can be reduced in several ways.  First, there may be conditions in the loan that allow the lender to ``call'' the loan and require immediate repayment.  These are typically rare.  Second, the loan may have a variable rate.  As market interest rates move, the payment \(c_s\) will change to accommodate.  While this helps reduce interest rate risk, it may increase credit risk since the borrower's ability to service debt may be impaired.   Third, the lender may purchase a swap to offset the interest rate risk.  Purchasing a swap brings another party to the table and may increase credit (or counterparty) risk.  
\\
\\
Credit risk can be reduced by requiring that the borrower post collateral.  In the event of default, the lender will receive the collateral.  There is still credit risk involved with securitized loans.  The collateral could depreciate to be lower than the value of the future contractual cash flows; leading to a loss.  The physical act of taking possession of the collateral may require time and resources.  
\subsubsection{Modeling Risk}
The economic definition of risk is uncertainty.  The mathematical model of uncertainty is probability.  To reflect the loan's credit risk, the cash flows from the loan can be written as 

\begin{equation} \label{riskyCashFlows} \int_t ^ T c_s \mathbb{I}_{\tau>s} ds+\mathbb{I}_{\tau<T} k_\tau \end{equation}
Where \(\mathbb{I}\) is the indicator function, \(\tau\) is the (random) time of default, and \(k\) is the cash flow generated from sale of collateral.  

\subsubsection{Risk free asset}

It is often convenient to assume the existence of a risk free asset \(M_t\).  By definition, the risk free asset returns
\[\frac{dM}{dt}=r_{f, t} M\]
Solving this ODE yields
\[M_T=M_t e^{\int_t ^T r_{f, s} ds}\]

Note that \(r_{f, t}\) is allowed to be stochastic.  Default free bonds can be considered derivative securities of this risk free asset.  The only risk in default free bonds (eg, Treasuries) is interest rate risk.  A common asset in this book will be a zero coupon bond which has a single cash flow \(c_T\) denoted \(B(t, T)\).  The yields on these default free zero coupon bonds are denoted \(r_{f, t, T}\) and can be computed using \ref{rateCC}.

\subsection{Value through time}
\label{valOfCashFlows}
The stream of cash flows defined in \ref{riskyCashFlows} has some value at every point \(s \in (t, T)\).  This value is denoted \(V_s\).  While we have not yet developed the toolkit in this book to approach finding the ``appropriate'' value \(V_s\), intuitively it should depend, in some sense, on the cash flows defined in \ref{riskyCashFlows}.  Put mathematically, 
\[V_s=g\left(   \int_s ^ T c_u \mathbb{I}_{\tau>u} du+\mathbb{I}_{s<\tau<T} k_\tau  \right) \]

The function \(g\) may depend on other variables aside from the cashflows.  The value does not depend on cash flows that have already been paid, which is reflected in the updated lower bound of the integral.  If default has occurred before \(s\) (and collateral has been sold) \(V_s\) should be zero.

\subsection{Modeling considerations: the loan market}

There are two markets for loans: the primary market where lenders and borrowers agree on terms for exchanging cash flows, and a secondary market where the promised cash flows can be exchanged.  For example, mortgage lenders will agree to terms with home buyers.  Mortgage lenders will then typically sell these loans to Fannie Mae.  Fannie Mae packages these loans and sells them to hedge funds, mutual funds, and other institutional investors.  
\\
\\
A secondary market does not always exist for loans which makes loan pricing both challenging and potentially rewarding. Most asset pricing literature considers that there is a market with prices for most if not all instruments.  This is the fundamental assumption for the models summarized in \ref{assetPricing}.  Indeed, practitioners in capital and equity markets frequently mark their models to market.  They assume a certain model for the market and then use market prices to calibrate the model.  
\\
\\
However, in general the value \(V_s\) from section \ref{valOfCashFlows} is not a price that is viewable in the market.  This can have benefits to the lender.  If the lender believes that a borrower has better credit worthiness than the (primary or secondary) market, the lender can originate a loan at better than cost.  However, if the price is viewable in the market, the lender can make the loan ``available for sale'' (AFS).  This requires the loan to be marked to market.  Even if the lender believes the loan is higher quality, the loan will be booked as if it is lower quality with the requisite capital charge.  If the lender is right, the loan will still provide superior cash flows than expected.  This higher quality won't be reflected in the balance sheet at the time of origination. 
\\
\\
If the loan is not available for sale then the loan is booked at ``par''; that is, the value of the asset is the amount lent \(P_t\).  A simple decision for whether to originate a loan could then be 

\begin{equation}
\left\{
\begin{array}{ll}
\text{originate loan if} & V_t \geq P_t\\
\text{do not originate otherwise} 
\end{array} \right.
\end{equation}

This decision is naive.  First, a loan is required to have additional reserves for expected losses under accounting rules (SEE LATER SECTION).  Second, a loan requires capital to withstand losses that are greater than expected.  Again, this will defined more rigorously in a later section.  

\subsection{Goal of this book}

The goal of this book is introduce methods for finding the ``appropriate'' price of a loan.  Section \ref{valOfCashFlows} introduces the notion that the stream of cash flows \ref{riskyCashFlows} has some value \(V_s\) at every point in time \(s\).  The lender and the borrower agree at origination time \(t\) on the structure of the cash flows.  The implicit goal in section \ref{valOfCashFlows} is that \emph{given} a series of cash flows there is some method of computing the current value of those cash flows.  The goal for the lender at time \(t\) is to find a set of cash flows such that the value \(V_t\) is maximized.  This goal is summarized as follows:

\begin{goal}[Lender's problem] \label{lender1}
	\[\max_{c_s} V_t\]
	
\end{goal}

There are three considerations not explicitly shown in this equation which makes the goal ill-posed.  First and most importantly, the borrower is able to decline the offer.  As \(c_s\) increases, the probability of the borrower declining the offer increases.  The second consideration is that as \(c_s\) increases there is an increase in the probability that \(\tau<T\).  The borrower will have less ability to service the cash flow and is more likely to default.  The third consideration is related to both the first two considerations and to the fact that the borrower has asymmetric information about his or her ability to repay the loan: as \(c_s\) increases, any borrower that does accept the offer is more likely to be a poorer quality customer.  The fact that the borrower chose a higher \(c_s\) indicates that there is little appetite for the borrower's risk in the market.  At a very high level of \(c_s\), the borrower is likely going to take the cash and run with no intention of repayment.  This is especially the case for subprime retail portfolios.  
\\
\\
These three considerations can be captured by considering the market cash flows \(c_{m, s}\).  However, as any loan officer will say, the statement \ref{lender1} is incorrectly stated.  Rather, in a competitive (primary) market, the cash flows \(c_s\) are ``fixed'' for a given level of ``widely available'' measures of risk (say, a level of debt service coverage).  Instead of choosing the cash flow to maximize \ref{valOfCashFlows}, the goal is to find areas where the lender can more accurately assess the probability that \(\tau<T\) and thus undercut the (primary) market.  
\\
\\
There are several mathematical methods for considering this phenomenon.  Perhaps the simplest is to model the ``market'' belief that the time to default random variable is \(\tau_m\) and the lender's belief is that the time to default random variable is \(\tau\).  The lender's problem then becomes the following:


\begin{goal}[Lender's problem revisited] \label{lender2}
	\[
	\left\{
	\begin{array}{ll}
	\text{originate loan if} & V_t\geq V_{t, m}\\
	\text{do not originate otherwise} 
	\end{array} \right.
	\]
	
\end{goal}

Where \(V_{t, m}\) is the market's valuation of the expected future cash flows.  This goal has the benefit of being most similar to how lenders typically run their business.  This goal unfortunately is not academically appealing.  As seen in \ref{assetPricing}, models for asset pricing typically assume that the market is correct.  Hence the formulation of \ref{lender2} is nonsensical.  The reason that \ref{lender2} makes some sense is the following:


\begin{enumerate}
	\item The loan market tends to be illiquid; that is, the value \(V_t\) is not a market price but a subjective valuation of the future cash flows.
	\item Loans that are securitized and made available on the market tend to have high level risk characteristics but may have idiosyncrasies that are only visible to the lender; that is, there is asynchronous information between the lender and the market.  
	\item The market does not always trust in the competency of lenders.  This can be seen by market prices of securitizations from new lenders.  These securitizations may look the same as from established lenders, but they will typically trade at a lower value simply because there is not as much trust that the lenders have the ability to originate quality loans.  
	
\end{enumerate}

Other shortcomings with \ref{lender2} is that it assumes the capital structure and loan mix is identical between the market and the lender.  

\subsection{Putting it all together}

NOTE Consider moving this to later in the book

There are now four formulas or values.  These are

\begin{enumerate}
	\item \(V_t\): the modeled (subjective) value of the loan to the lender
	\item \(V_{t, min}\): the modeled (subjective) minimum value of the loan to the lender
	\item \(V_{t, m}\): the (directly unobservable) value of the loan in the primary market
	\item \(S_t\): the (potentially unobservable) price of the loan in the secondary market
	
\end{enumerate}

The lending decision should be:


\begin{goal}[Lender's final problem] \label{lender3}
	\[
	\left\{
	\begin{array}{ll}
	\text{originate loan if} & V_t \geq V_{t, min}\\
	\text{do not originate otherwise} 
	\end{array} \right.
	\]
	
\end{goal}

The primary and secondary market values do not directly impact the origination decision.  However, these values should be tracked over a broad set of originations.  For example, consider the following scenarios:

\begin{enumerate}
	\item ``Good'' scenario:  \(V_t<S_t\) or \(V_t<V_{t, m}\).  If the lender's subjective valuation is consistently lower than the market's, the lender's capital is either better suited (or more diversified) for the loans that the lender originates or the lender's models are better (or worse!) than the market's.  The performance of the model can be tracked temperately.  If the model performance is adequate, then consistently undercutting the  market is a good thing.  
	\item ``Bad'' scenario: \(V_{t, min}>S_t\) or \(V_{t, min}>V_{t, m}\).  The lender is inappropriately deploying capital or has a significant model problem.  The lender may need to consider other lending products.  
\end{enumerate}

These values can be tracked in a number of ways.  The primary market valuation for a loan can be assessed through an ongoing study of percentage of applications are funded and through random price testing.  The secondary market price can only be tracked for those loans that are publicly tradeable.  Secondary market loans may have less information about the borrower than is known by the lender which may influence the price.  


\section{Introduction to Asset Pricing} \label{assetPricing}

There are three primary academic approaches to asset pricing.  The original approach is founded in utility theory.  This approach is theoretically rigorous but lacks precision.  It is best described as a phenomenological model of asset pricing but is not intended to provide a framework for precisely pricing assets.  However, the other two pricing approaches are consistent with this original approach and owe much to utility theory.  The second approach is the theory Capital Asset Pricing Model approach pioneered by Markowitz, Sharpe, and others.  Markowitz developed a theory around choosing optimal portfolios assuming either quadratic preferences or Gaussian asset returns.  Sharpe created a way to estimate what the expected return of an asset should be based off the correlation with the rest of the market.  This approach is more precise than utility theory but is prone to model error.  It is not easy to generalize the approach.  Again, the approach is primarily a good mental model for asset pricing.  The third approach is the replicating portfolio argument pioneered by Black and Scholes.  This technique is primarily applicable to derivative securities where the price can be determined by other assets.  The approach has proved very precise and rigorous.  It has also proven extensible and general.  
\\
\\
This section is devoted to more detailed descriptions of these three approaches.  The section motivates various ways of thinking about loan pricing.

\subsection{Utility theory}
Utility theory states than a given individual (homo economicus) seeks to maximize a function \(U\) that satisfies the ``usual'' conditions:
\begin{enumerate}
\item \(U'(x)>0\)
\item \(U''(x)<0\)
\end{enumerate}

In general, utility functions need not be continuous and don't require derivatives to be defined.  Indeed, all that is required for our discussion is that the utility function is concave.  However, since exact results are not required from this approach for our purposes, the useful mental picture is to assume continuity and differentiability.
\\
\\
The above conditions imply non-satiability and risk-aversion.  Risk-aversion is the more important aspect from an asset pricing perspective.  By Jenson's inequality, 
\[\mathbb{E}[\phi(X)]<=\phi(\mathbb{E}[X])\]
for concave \(\phi\).  For a risky asset \(Y\), the value placed on the asset by an individual with utility function \(U\) is \(\mathbb{E}[U(Y)]\).  This is less than the utility gained from the expected value of the asset.  The return required by the individual for the asset \(Y\) is higher than a return for a degenerate (non-risky) asset \(Z\).   
\\
\\
Applying this theory to the cash flow equation \ref{riskyCashFlows} the utility gained is

\[\mathbb{E}\left[U\left( \int_t ^ T c_s \mathbb{I}_{\tau>s} ds+\mathbb{I}_{\tau<T} k_\tau \right) \right]\]

If both the utility function and the distribution of \(\tau\) is known, in theory we could create the indifference curve between the utility of holding the money and the utility of lending out the money and receiving the cash flows.  In a simple model with a risk free asset, the money could be invested at a low (but risk free) rate.  However, the utility function is only applicable to a given person and is very difficult to estimate in practice.  Additionally, in reality there is a large set of investments.  It is impracticable to optimize over the entire investment set.  Markowtiz solved this problem under a certain set of assumptions with modern portfolio theory.  

\subsection{Modern Portfolio Theory and CAPM}
Under the assumption that asset returns are Gaussian, Markowitz formulated an optimization problem specifying the amount to invest in every asset in the market.  The theory reduces the problem of utility optimization to one that explores the tradeoff between variance and expected returns.  For a given level of variance (risk-tolerance), the goal of the problem is to maximize the return.  The theory formalizes and makes a precise recommendation around the notion of asset diversification.  However, the theory treats expected returns and variances as fixed and known constants.  The price of the assets are not modeled; rather if every market participant followed the mean-variance recommendations there would be a market-based price for every asset based on the prevailing level of risk-tolerance.  
\\
\\
Sharpe used the theory to compute the expected return for a given stock.  To gain intuition for Sharpe's theory, consider a world in which the following is true:
\begin{enumerate}
\item There exists an infinite number of assets
\item The returns of these assets are independent (uncorrelated)
\end{enumerate}

A portfolio that contains these assets would have zero variance.  A portfolio that has no risk must return the risk free rate in equilibrium.  Using this intuition, any risky asset should return excess of the risk free rate only through its correlation with the rest of the market.  This leads to the celebrated CAPM formula 
\[\mathbb{E}[r_{i, t, T}]=r_{f, t, T}+\beta_i \left(\mathbb{E}[r_{m, t, T}]-r_{f, t, T}\right)\]
The \(\beta\) is the effect that the market has on the expected return on the asset \(i\).  A \(\beta\) of zero corresponds with an expected return of \(r_f\), or the risk free rate.
\\
\\
The primary relevance of CAPM on loan pricing is the concept of diversification and the dependence of the price of an asset on the existence of other assets.  In a large portfolio of uncorrelated loans and in an efficient market, the interest rate should only compensate for the expected loss of the loan.  
\\
\\
Let the \emph{loss distribution} of a portfolio of \(n\) loans be defined as follows:

\begin{equation}
\mathbb{P}(L<l)
\end{equation}

Where \(L=\sum_i X_i \) and \(X_i\) is the random variable describing the risky cash flows of loan \(i\).  As proven in Vasicek (1989), if \(\mathbb{E}[X_iX_j]-\mathbb{E}[X_i]\mathbb{E}[X_j]=0\,\forall\,i,\,j\) then \( \lim_{n \to \infty}\mathbb{V}[L] \to 0\).  By the definition of expectations, the expected gain for \(L\) is simply \(\sum_i \mathbb{E}[X_i]\).  In equilibrium, this expected gain must equal the risk free rate since the portfolio has no risk.  If we further assume that the loans are homogeneous, we can also exactly find the ``correct'' interest rate for each loan as follows:

\[
\mathbb{E}\left[\int_t ^ T c_s \mathbb{I}_{\tau>s} ds+\mathbb{I}_{\tau<T} k_\tau\right]=e^{r_{f, t, T}(T-t)}=B(t, T)
\]


[TODO!!!! Need to show that solving the interest rate for a single coupon is sufficient.  No need to consider more than cash flow]




\end{document}